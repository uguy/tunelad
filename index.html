<!doctype html>
<html lang="en">
<head>
    <title>Tune Lad !</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
          crossorigin="anonymous">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css"
          integrity="sha384-b6lVK+yci+bfDmaY1u0zE8YYJt0TZxLEAFyYSLHId4xoVvsrQu3INevFKo+Xir8e"
          crossorigin="anonymous">
</head>
<body>
<div class="container mt-5">
    <h1>Tracks</h1>
    <br>
    <div class="row g-3">
        <div class="col-sm-7">
            <input id="search-input" class="form-control" type="text" placeholder="search for tracks">
        </div>
        <div class="col-sm-2">
            <button  type="button" class="btn btn-outline-primary" onclick="refreshTracks()">
                <i class="bi bi-search"></i>
            </button>
        </div>
    </div>
    <hr>
    <div>
        <div id="trackList">

        </div>
    </div>
</div>
<hr>
<audio id="player" controls  preload="none" style="width: 100%"></audio>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
<script>

    function refreshTracks() {
        const q = document.getElementById('search-input').value
        fetch('api/search/tracks?q='+q)
            .then((response) => response.json())
            .then((tracks) => {
                document.getElementById('trackList').innerHTML = "";
                for (index in tracks) {
                    let track = tracks[index]
                    let tags = ''
                    if(track.tags){
                        track.tags.forEach(tag => tags += '<span class="badge rounded-pill bg-secondary text-dark">' + tag + '</span>')
                    }
                    document.getElementById('trackList').innerHTML += `
<details>
    <summary><button class="btn btn-secondary btn-sm" onclick="playTrack('${track.id}')" ><i class="bi bi-play-circle"></i></button> ${track.title} </summary>
    <p>${track.description}</p>
    <ul>
        <li>Album : ${track.album}</li>
        <li>Tags : ${tags}</li>
    </ul>
</details>`;
                }
            })
    }

    function playTrack(trackId) {
        document.getElementById("player").src = `api/tracks/${trackId}/play`;
        document.getElementById("player").play();
    };

    document.onreadystatechange = ev => refreshTracks()

</script>
</body>
</html>
